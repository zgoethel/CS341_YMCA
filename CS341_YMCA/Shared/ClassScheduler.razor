@using CS341_YMCA.Data
@using CS341_YMCA.Controllers
@using CS341_YMCA.Pages

@inject ClassController Classes

@if(!string.IsNullOrEmpty(ValidationMessage))
{
    <div class="alert alert-warning">
        @ValidationMessage
    </div>
}

@*if (ShowEditing)
{
    <button class="btn btn-primary" style="float: right;" @onclick=OnAddClick>
        <i class="oi oi-plus"></i>
    </button>
}*@

<div style="height: 3.2em;">
    <h3 class="mt-1 me-4"
        style="float: left;cursor: pointer;">
    <i class="oi oi-chevron-left"
        @onclick="() => { WeekStart = WeekStart.AddDays(-7); }"
    /></h3>

    <h3 class="mt-1 ms-4 me-4 text-info"
        style="float: right;cursor: pointer;"
        @onclick="() => { WeekStart = WeekStart.AddDays(7); }">
        MORE
    <i class="ms-2 oi oi-chevron-right" /></h3>
    <h3 class="mt-1" style="float: left;">
        Week of @WeekStart.ToLongDateString().Replace("Sunday, ", "")
    </h3>
</div>

@{
    string[] _Days = { "Su", "Mo", "Tu", "We", "Th", "Fr", "Sa" };
}

<div class="row _col-no-margin mt-1">
    @for (int j = 0; j < 7; j++)
    {
        <div style="width: 14%;" class="col">
            <h3>@_Days[j]</h3>
            <ClassScheduleDay
                Class=@Class
                Schedule=@Schedule
                Date=@WeekStart.AddDays(j)
            />
        </div>
    }
</div>


@code
{
    [Parameter]
    public ClassDBO Class { get; set; } = new();
    [Parameter]
    public bool ShowEditing { get; set; } = false;
    [Parameter]
    public ManageClass Manager { get; set; } = new();

    private List<ClassScheduleDBO> Schedule = new();
    private string ValidationMessage = "";
    private DateTime WeekStart = DateTime.Today;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        Schedule = Classes.ClassSchedule_List(Class!.Id).Get()!;

        var _WeekStart = Schedule.FirstOrDefault()?.FirstDate ?? DateTime.Today;
        WeekStart = WeekStart.AddDays(-(int)WeekStart.DayOfWeek);

        StateHasChanged();
    }

    private void OnAddClick()
    {
        var Created = new ClassScheduleDBO();
        Schedule.Add(Created);

        StateHasChanged();
    }
}

<style>
    div._col-no-margin .col
    {
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding: 0.2em;
        min-width: 6.5em;
        max-width: 14%;
    }
</style>